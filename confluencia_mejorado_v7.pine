// This Pine ScriptÂ® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© diegosantacruz

//@version=6
indicator(title="Confluencia 7", shorttitle="Confluenc7", overlay=true)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIGURACIÃ“N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Confluencia mÃ­nima requerida
min_confluence = input.int(4, "Confluencia MÃ­nima (de 6)", minval=3, maxval=6, group="Sistema",
     tooltip="MÃ­nimo 4/6 recomendado para mayor precisiÃ³n")
min_score = input.int(70, "Score MÃ­nimo (%)", minval=60, maxval=90, group="Sistema",
     tooltip="Score mÃ­nimo para seÃ±ales fuertes (70% recomendado)")
show_weak_signals = input.bool(false, "Mostrar SeÃ±ales DÃ©biles", group="Sistema",
     tooltip="Mostrar seÃ±ales con confluencia menor a la mÃ­nima")

// Filtros de calidad (NUEVOS)
enable_trend_filter = input.bool(true, "Filtro de Tendencia", group="Filtros de Calidad",
     tooltip="No comprar en tendencia bajista ni vender en tendencia alcista")
enable_candle_filter = input.bool(true, "Filtro de Velas", group="Filtros de Calidad",
     tooltip="Evitar seÃ±ales en velas con indecisiÃ³n (sombras largas)")
enable_volume_filter = input.bool(true, "Filtro de Volumen", group="Filtros de Calidad",
     tooltip="Requerir volumen superior al promedio para seÃ±ales")
min_bars_between = input.int(5, "Barras MÃ­nimas Entre SeÃ±ales", minval=1, maxval=20, group="Filtros de Calidad",
     tooltip="Evitar seÃ±ales muy seguidas (cooldown)")

// VisualizaciÃ³n
show_signals = input.bool(true, "Mostrar SeÃ±ales", group="VisualizaciÃ³n")
show_indicators = input.bool(true, "Mostrar Indicadores en Chart", group="VisualizaciÃ³n")
show_table = input.bool(true, "Mostrar Tabla de Confluencia", group="VisualizaciÃ³n")
show_filters = input.bool(true, "Mostrar Estado de Filtros", group="VisualizaciÃ³n")

// Alertas
enable_alerts = input.bool(true, "Activar Alertas", group="Alertas")

// ParÃ¡metros de indicadores (ajustables)
ema_fast = input.int(20, "EMA RÃ¡pida", minval=1, group="ParÃ¡metros")
ema_slow = input.int(50, "EMA Lenta", minval=1, group="ParÃ¡metros")
ema_trend = input.int(200, "EMA Tendencia", minval=1, group="ParÃ¡metros")
asl_length = input.int(21, "ASL Length", minval=1, group="ParÃ¡metros")
rsi_length = input.int(14, "RSI Length", minval=1, group="ParÃ¡metros")
macd_fast = input.int(12, "MACD Fast", minval=1, group="ParÃ¡metros")
macd_slow = input.int(26, "MACD Slow", minval=1, group="ParÃ¡metros")
macd_signal = input.int(9, "MACD Signal", minval=1, group="ParÃ¡metros")

// Colores para las medias
color_asl = input.color(#00FF00, "ASL 21", group="Colores")
color_fast = input.color(#2196F3, "EMA RÃ¡pida (20)", group="Colores")
color_slow = input.color(#FF9800, "EMA Lenta (50)", group="Colores")
color_trend = input.color(#9C27B0, "EMA Tendencia (200)", group="Colores")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CUSTOM TYPES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type IndicatorSignal
    bool bullish        // SeÃ±al alcista del indicador
    bool bearish        // SeÃ±al bajista del indicador
    float strength      // Fuerza de la seÃ±al (0-1)
    string status       // Estado descriptivo

type ConfluenceResult
    int bullish_count   // Cantidad de indicadores alcistas
    int bearish_count   // Cantidad de indicadores bajistas
    float bull_score    // Score alcista (0-100)
    float bear_score    // Score bajista (0-100)
    bool strong_buy     // SeÃ±al fuerte de compra
    bool strong_sell    // SeÃ±al fuerte de venta
    string recommendation // RecomendaciÃ³n textual

type FilterStatus
    bool trend_ok       // Filtro de tendencia OK
    bool candle_ok      // Filtro de vela OK
    bool volume_ok      // Filtro de volumen OK
    bool cooldown_ok    // Filtro de cooldown OK
    bool all_pass       // Todos los filtros pasan
    string reason       // RazÃ³n si falla

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FUNCIONES AUXILIARES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Calcular ASL (Average of EMA and WMA)
calc_asl(int length) =>
    (ta.ema(close, length-1) + ta.wma(close, length)) / 2

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICADOR 1: ASL21
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

calc_asl_signal() =>
    asl21 = calc_asl(asl_length)

    // Cruce del precio con ASL
    crossing_up = ta.crossover(close, asl21)
    crossing_down = ta.crossunder(close, asl21)

    // PosiciÃ³n respecto a ASL
    above_asl = close > asl21
    below_asl = close < asl21

    // Pendiente de ASL (alcista/bajista)
    asl_rising = asl21 > asl21[1]
    asl_falling = asl21 < asl21[1]

    // Calcular fuerza (0-1)
    strength_bull = 0.0
    strength_bear = 0.0

    if crossing_up and asl_rising
        strength_bull := 1.0
    else if above_asl and asl_rising
        strength_bull := 0.7
    else if above_asl
        strength_bull := 0.4

    if crossing_down and asl_falling
        strength_bear := 1.0
    else if below_asl and asl_falling
        strength_bear := 0.7
    else if below_asl
        strength_bear := 0.4

    // Estado
    status = crossing_up ? "Cruce Alcista" :
             crossing_down ? "Cruce Bajista" :
             above_asl and asl_rising ? "Alcista Fuerte" :
             below_asl and asl_falling ? "Bajista Fuerte" :
             above_asl ? "Alcista" :
             below_asl ? "Bajista" : "Neutral"

    [IndicatorSignal.new(strength_bull > 0.5, strength_bear > 0.5, math.max(strength_bull, strength_bear), status), asl21]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICADOR 2: MEDIAS MÃ“VILES (EMAs)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

calc_ema_signal() =>
    ema20 = ta.ema(close, ema_fast)
    ema50 = ta.ema(close, ema_slow)
    ema200 = ta.ema(close, ema_trend)

    // Cruce de medias
    golden_cross = ta.crossover(ema20, ema50)
    death_cross = ta.crossunder(ema20, ema50)

    // AlineaciÃ³n de tendencia
    uptrend = close > ema200
    downtrend = close < ema200

    // AlineaciÃ³n completa
    full_bullish = ema20 > ema50 and ema50 > ema200
    full_bearish = ema20 < ema50 and ema50 < ema200

    // Calcular fuerza (0-1)
    strength_bull = 0.0
    strength_bear = 0.0

    if golden_cross and uptrend
        strength_bull := 1.0
    else if ema20 > ema50 and uptrend
        strength_bull := 0.7
    else if uptrend
        strength_bull := 0.3

    if death_cross and downtrend
        strength_bear := 1.0
    else if ema20 < ema50 and downtrend
        strength_bear := 0.7
    else if downtrend
        strength_bear := 0.3

    // Estado
    status = full_bullish ? "Alcista Fuerte" :
             full_bearish ? "Bajista Fuerte" :
             uptrend ? "Alcista" :
             downtrend ? "Bajista" : "Neutral"

    [IndicatorSignal.new(strength_bull > 0.5, strength_bear > 0.5, math.max(strength_bull, strength_bear), status),
     ema20, ema50, ema200]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICADOR 3: MACD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

calc_macd_signal() =>
    [macd_line, signal_line, hist] = ta.macd(close, macd_fast, macd_slow, macd_signal)

    // Cruces
    bullish_cross = ta.crossover(macd_line, signal_line)
    bearish_cross = ta.crossunder(macd_line, signal_line)

    // PosiciÃ³n respecto a cero
    above_zero = macd_line > 0
    below_zero = macd_line < 0

    // Histograma creciendo/decreciendo
    hist_growing = hist > hist[1]
    hist_falling = hist < hist[1]

    // Calcular fuerza
    strength_bull = 0.0
    strength_bear = 0.0

    if bullish_cross and above_zero
        strength_bull := 1.0
    else if bullish_cross
        strength_bull := 0.7
    else if macd_line > signal_line and hist_growing
        strength_bull := 0.5
    else if macd_line > signal_line
        strength_bull := 0.3

    if bearish_cross and below_zero
        strength_bear := 1.0
    else if bearish_cross
        strength_bear := 0.7
    else if macd_line < signal_line and hist_falling
        strength_bear := 0.5
    else if macd_line < signal_line
        strength_bear := 0.3

    // Estado
    status = bullish_cross ? "Cruce Alcista" :
             bearish_cross ? "Cruce Bajista" :
             macd_line > signal_line and above_zero ? "Alcista Fuerte" :
             macd_line < signal_line and below_zero ? "Bajista Fuerte" :
             macd_line > signal_line ? "Alcista" :
             macd_line < signal_line ? "Bajista" : "Neutral"

    IndicatorSignal.new(strength_bull > 0.5, strength_bear > 0.5, math.max(strength_bull, strength_bear), status)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICADOR 4: RSI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

calc_rsi_signal() =>
    rsi = ta.rsi(close, rsi_length)

    // Zonas
    oversold = rsi < 30
    overbought = rsi > 70
    neutral_low = rsi >= 30 and rsi < 50
    neutral_high = rsi >= 50 and rsi <= 70

    // Cruces de niveles
    crossing_up_30 = ta.crossover(rsi, 30)
    crossing_down_70 = ta.crossunder(rsi, 70)
    crossing_up_50 = ta.crossover(rsi, 50)
    crossing_down_50 = ta.crossunder(rsi, 50)

    // Calcular fuerza
    strength_bull = 0.0
    strength_bear = 0.0

    if crossing_up_30
        strength_bull := 1.0
    else if crossing_up_50
        strength_bull := 0.8
    else if neutral_high
        strength_bull := 0.5
    else if oversold
        strength_bull := 0.7

    if crossing_down_70
        strength_bear := 1.0
    else if crossing_down_50
        strength_bear := 0.8
    else if neutral_low
        strength_bear := 0.5
    else if overbought
        strength_bear := 0.7

    // Estado
    status = oversold ? "Sobreventa" :
             overbought ? "Sobrecompra" :
             crossing_up_30 ? "Salida Sobreventa" :
             crossing_down_70 ? "Salida Sobrecompra" :
             neutral_high ? "Alcista" :
             neutral_low ? "Bajista" : "Neutral"

    IndicatorSignal.new(strength_bull > 0.5, strength_bear > 0.5, math.max(strength_bull, strength_bear), status)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICADOR 5: VOLUMEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

calc_volume_signal() =>
    // Volumen promedio
    vol_ma = ta.sma(volume, 20)

    // Volumen alto = mÃ¡s de 1.5x el promedio
    high_volume = volume > vol_ma * 1.5

    // DirecciÃ³n del precio
    price_up = close > close[1]
    price_down = close < close[1]

    // Vela alcista/bajista fuerte
    body_size = math.abs(close - open)
    avg_body = ta.sma(body_size, 14)
    strong_candle = body_size > avg_body * 1.5

    // Calcular fuerza
    strength_bull = 0.0
    strength_bear = 0.0

    if high_volume and price_up and strong_candle
        strength_bull := 1.0
    else if high_volume and price_up
        strength_bull := 0.7
    else if price_up
        strength_bull := 0.3

    if high_volume and price_down and strong_candle
        strength_bear := 1.0
    else if high_volume and price_down
        strength_bear := 0.7
    else if price_down
        strength_bear := 0.3

    // Estado
    status = high_volume and price_up ? "Compra Fuerte" :
             high_volume and price_down ? "Venta Fuerte" :
             price_up ? "Compra Normal" :
             price_down ? "Venta Normal" : "Neutral"

    [IndicatorSignal.new(strength_bull > 0.5, strength_bear > 0.5, math.max(strength_bull, strength_bear), status),
     volume, vol_ma]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICADOR 6: MOMENTUM (Rate of Change)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

calc_momentum_signal() =>
    // ROC (Rate of Change)
    roc = ta.roc(close, 10)
    roc_ma = ta.sma(roc, 10)

    // Momentum positivo/negativo
    positive_momentum = roc > 0
    negative_momentum = roc < 0

    // Acelerando/desacelerando
    accelerating = roc > roc_ma
    decelerating = roc < roc_ma

    // Calcular fuerza
    strength_bull = 0.0
    strength_bear = 0.0

    if positive_momentum and accelerating and roc > 2
        strength_bull := 1.0
    else if positive_momentum and accelerating
        strength_bull := 0.7
    else if positive_momentum
        strength_bull := 0.4

    if negative_momentum and decelerating and roc < -2
        strength_bear := 1.0
    else if negative_momentum and decelerating
        strength_bear := 0.7
    else if negative_momentum
        strength_bear := 0.4

    // Estado
    status = positive_momentum and accelerating ? "Acelerando â†‘" :
             negative_momentum and decelerating ? "Acelerando â†“" :
             positive_momentum ? "Positivo" :
             negative_momentum ? "Negativo" : "Neutral"

    IndicatorSignal.new(strength_bull > 0.5, strength_bear > 0.5, math.max(strength_bull, strength_bear), status)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTROS DE CALIDAD (NUEVO)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

check_quality_filters(bool is_buy, simple float ema20, simple float ema50, simple float ema200,
                      simple float vol, simple float vol_ma) =>

    // 1. FILTRO DE TENDENCIA
    trend_ok = true
    trend_reason = ""

    if enable_trend_filter
        if is_buy
            // No comprar si precio estÃ¡ debajo de EMA200 Y las EMAs estÃ¡n en orden bajista
            strong_downtrend = close < ema200 and ema20 < ema50 and ema50 < ema200
            trend_ok := not strong_downtrend
            trend_reason := strong_downtrend ? "âŒ Tendencia Bajista Fuerte" : "âœ“ Tendencia OK"
        else
            // No vender si precio estÃ¡ arriba de EMA200 Y las EMAs estÃ¡n en orden alcista
            strong_uptrend = close > ema200 and ema20 > ema50 and ema50 > ema200
            trend_ok := not strong_uptrend
            trend_reason := strong_uptrend ? "âŒ Tendencia Alcista Fuerte" : "âœ“ Tendencia OK"

    // 2. FILTRO DE VELA (evitar velas con mucha indecisiÃ³n)
    candle_ok = true
    candle_reason = ""

    if enable_candle_filter
        body = math.abs(close - open)
        upper_shadow = high - math.max(close, open)
        lower_shadow = math.min(close, open) - low
        total_range = high - low

        // Vela de indecisiÃ³n: cuerpo menor al 30% del rango total
        indecision = total_range > 0 and body / total_range < 0.3

        // Sombras muy largas (mÃ¡s del doble del cuerpo)
        long_shadows = (upper_shadow > body * 2) or (lower_shadow > body * 2)

        candle_ok := not (indecision or long_shadows)
        candle_reason := not candle_ok ? "âŒ Vela Indecisa" : "âœ“ Vela OK"

    // 3. FILTRO DE VOLUMEN
    volume_ok = true
    volume_reason = ""

    if enable_volume_filter
        // Requerir volumen al menos igual al promedio (no necesariamente alto)
        volume_ok := vol >= vol_ma * 0.8
        volume_reason := not volume_ok ? "âŒ Volumen Bajo" : "âœ“ Volumen OK"

    // 4. FILTRO DE COOLDOWN (evitar seÃ±ales muy seguidas)
    var int last_buy_bar = -999
    var int last_sell_bar = -999

    cooldown_ok = true
    cooldown_reason = ""

    if is_buy
        bars_since = bar_index - last_buy_bar
        cooldown_ok := bars_since >= min_bars_between
        cooldown_reason := not cooldown_ok ? "âŒ Cooldown (" + str.tostring(bars_since) + " barras)" : "âœ“ Cooldown OK"
        if cooldown_ok
            last_buy_bar := bar_index
    else
        bars_since = bar_index - last_sell_bar
        cooldown_ok := bars_since >= min_bars_between
        cooldown_reason := not cooldown_ok ? "âŒ Cooldown (" + str.tostring(bars_since) + " barras)" : "âœ“ Cooldown OK"
        if cooldown_ok
            last_sell_bar := bar_index

    // Resultado final
    all_pass = trend_ok and candle_ok and volume_ok and cooldown_ok

    reason = not trend_ok ? trend_reason : not candle_ok ? candle_reason : not volume_ok ? volume_reason : not cooldown_ok ? cooldown_reason : "âœ“ Todos los filtros OK"

    FilterStatus.new(trend_ok, candle_ok, volume_ok, cooldown_ok, all_pass, reason)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃLCULO DE CONFLUENCIA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

calc_confluence() =>
    // Obtener seÃ±ales de todos los indicadores
    [asl_sig, asl21] = calc_asl_signal()
    [ema_sig, ema20, ema50, ema200] = calc_ema_signal()
    macd_sig = calc_macd_signal()
    rsi_sig = calc_rsi_signal()
    [vol_sig, vol, vol_ma] = calc_volume_signal()
    mom_sig = calc_momentum_signal()

    // Contar votos alcistas y bajistas
    bull_count = 0
    bear_count = 0

    if asl_sig.bullish
        bull_count += 1
    if asl_sig.bearish
        bear_count += 1

    if ema_sig.bullish
        bull_count += 1
    if ema_sig.bearish
        bear_count += 1

    if macd_sig.bullish
        bull_count += 1
    if macd_sig.bearish
        bear_count += 1

    if rsi_sig.bullish
        bull_count += 1
    if rsi_sig.bearish
        bear_count += 1

    if vol_sig.bullish
        bull_count += 1
    if vol_sig.bearish
        bear_count += 1

    if mom_sig.bullish
        bull_count += 1
    if mom_sig.bearish
        bear_count += 1

    // Calcular score ponderado (0-100) - MEJORADO: mÃ¡s peso a EMAs y MACD
    bull_score = (asl_sig.strength * 15 + ema_sig.strength * 25 + macd_sig.strength * 25 + rsi_sig.strength * 15 + vol_sig.strength * 10 + mom_sig.strength * 10)

    bear_score = (asl_sig.strength * 15 + ema_sig.strength * 25 + macd_sig.strength * 25 + rsi_sig.strength * 15 + vol_sig.strength * 10 + mom_sig.strength * 10)

    // Solo contar score del lado correcto
    final_bull_score = asl_sig.bullish or ema_sig.bullish or macd_sig.bullish or rsi_sig.bullish or vol_sig.bullish or mom_sig.bullish ? bull_score : 0
    final_bear_score = asl_sig.bearish or ema_sig.bearish or macd_sig.bearish or rsi_sig.bearish or vol_sig.bearish or mom_sig.bearish ? bear_score : 0

    // SeÃ±ales fuertes (confluencia mÃ­nima alcanzada + score mÃ­nimo)
    strong_buy_base = bull_count >= min_confluence and final_bull_score >= min_score
    strong_sell_base = bear_count >= min_confluence and final_bear_score >= min_score

    // Aplicar filtros de calidad
    buy_filters = check_quality_filters(true, ema20, ema50, ema200, vol, vol_ma)
    sell_filters = check_quality_filters(false, ema20, ema50, ema200, vol, vol_ma)

    strong_buy = strong_buy_base and buy_filters.all_pass
    strong_sell = strong_sell_base and sell_filters.all_pass

    // RecomendaciÃ³n
    recommendation = strong_buy ? "COMPRAR ğŸš€" : strong_sell ? "VENDER âš ï¸" : strong_buy_base and not buy_filters.all_pass ? "Compra Filtrada" : strong_sell_base and not sell_filters.all_pass ? "Venta Filtrada" : bull_count >= 3 ? "Compra (dÃ©bil)" : bear_count >= 3 ? "Venta (dÃ©bil)" : bull_count > bear_count ? "Sesgo Alcista" : bear_count > bull_count ? "Sesgo Bajista" : "ESPERAR â¸"

    [ConfluenceResult.new(bull_count, bear_count, final_bull_score, final_bear_score,
                          strong_buy, strong_sell, recommendation),
     asl_sig, ema_sig, macd_sig, rsi_sig, vol_sig, mom_sig, asl21, ema20, ema50, ema200,
     buy_filters, sell_filters]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃLCULOS PRINCIPALES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[confluence, asl_sig, ema_sig, macd_sig, rsi_sig, vol_sig, mom_sig, asl21, ema20, ema50, ema200,
 buy_filters, sell_filters] = calc_confluence()

// Detectar nuevas seÃ±ales (cambio de estado)
var bool prev_strong_buy = false
var bool prev_strong_sell = false

new_buy_signal = confluence.strong_buy and not prev_strong_buy
new_sell_signal = confluence.strong_sell and not prev_strong_sell

prev_strong_buy := confluence.strong_buy
prev_strong_sell := confluence.strong_sell

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLOTEO DE INDICADORES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ASL21
plot(show_indicators ? asl21 : na, "ASL 21", color=color.new(color_asl, 0), linewidth=2)

// EMAs
plot(show_indicators ? ema20 : na, "EMA 20", color=color.new(color_fast, 0), linewidth=2)
plot(show_indicators ? ema50 : na, "EMA 50", color=color.new(color_slow, 0), linewidth=2)
plot(show_indicators ? ema200 : na, "EMA 200", color=color.new(color_trend, 0), linewidth=3)

// Labels de nombres al final de las lÃ­neas
if barstate.islast and show_indicators
    label.new(x=time, y=asl21, text="ASL21", xloc=xloc.bar_time, yloc=yloc.price,
              color=color.rgb(0, 0, 0, 100), style=label.style_label_left, textcolor=color_asl, size=size.small)
    label.new(x=time, y=ema20, text="EMA20", xloc=xloc.bar_time, yloc=yloc.price,
              color=color.rgb(0, 0, 0, 100), style=label.style_label_left, textcolor=color_fast, size=size.small)
    label.new(x=time, y=ema50, text="EMA50", xloc=xloc.bar_time, yloc=yloc.price,
              color=color.rgb(0, 0, 0, 100), style=label.style_label_left, textcolor=color_slow, size=size.small)
    label.new(x=time, y=ema200, text="EMA200", xloc=xloc.bar_time, yloc=yloc.price,
              color=color.rgb(0, 0, 0, 100), style=label.style_label_left, textcolor=color_trend, size=size.small)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SEÃ‘ALES VISUALES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// SeÃ±ales fuertes
if show_signals and new_buy_signal
    label.new(bar_index, low,
         text="âœ“ COMPRA\n" + str.tostring(confluence.bullish_count) + "/6 â€¢ " + str.tostring(confluence.bull_score, "#") + "%\n$" + str.tostring(close, "#.##"),
         color=color.new(#044A04, 0),
         textcolor=color.white,
         style=label.style_label_up,
         size=size.small)

if show_signals and new_sell_signal
    label.new(bar_index, high,
         text="âœ“ VENTA\n" + str.tostring(confluence.bearish_count) + "/6 â€¢ " + str.tostring(confluence.bear_score, "#") + "%\n$" + str.tostring(close, "#.##"),
         color=color.new(#7A1C1C, 0),
         textcolor=color.white,
         style=label.style_label_down,
         size=size.small)

// SeÃ±ales dÃ©biles (opcional)
weak_buy = confluence.bullish_count >= 2 and confluence.bullish_count < min_confluence and confluence.bullish_count > confluence.bearish_count
weak_sell = confluence.bearish_count >= 2 and confluence.bearish_count < min_confluence and confluence.bearish_count > confluence.bullish_count

if show_signals and show_weak_signals and weak_buy and not confluence.strong_buy
    label.new(bar_index, low,
         text=str.tostring(confluence.bullish_count) + "/6",
         color=color.new(color.green, 50),
         textcolor=color.white,
         style=label.style_label_up,
         size=size.tiny)

if show_signals and show_weak_signals and weak_sell and not confluence.strong_sell
    label.new(bar_index, high,
         text=str.tostring(confluence.bearish_count) + "/6",
         color=color.new(color.red, 50),
         textcolor=color.white,
         style=label.style_label_down,
         size=size.tiny)

// Marcadores en el grÃ¡fico para seÃ±ales fuertes
plotshape(show_signals and new_buy_signal, "Compra Fuerte",
     shape.triangleup, location.belowbar, color.new(#044A04, 0), size=size.small)

plotshape(show_signals and new_sell_signal, "Venta Fuerte",
     shape.triangledown, location.abovebar, color.new(#7A1C1C, 0), size=size.small)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABLA DE CONFLUENCIA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if show_table and barstate.islast
    var table conf_table = table.new(position.top_right, 3, 11,
         border_width=1,
         border_color=color.gray,
         frame_width=1,
         frame_color=color.gray)

    // Header
    table.cell(conf_table, 0, 0, "Sistema Confluencia v7 ULTRA",
         text_color=color.white,
         bgcolor=color.new(color.purple, 20),
         text_size=size.normal)
    table.merge_cells(conf_table, 0, 0, 2, 0)

    // Precio
    table.cell(conf_table, 0, 1, "Precio",
         text_color=color.white,
         bgcolor=color.new(color.gray, 50))
    table.cell(conf_table, 1, 1, "$" + str.tostring(close, "#.##"),
         text_color=color.white,
         bgcolor=color.new(color.blue, 70))
    table.merge_cells(conf_table, 1, 1, 2, 1)

    // Confluencia
    conf_text = str.tostring(confluence.bullish_count) + "/6 ğŸŸ¢  " + str.tostring(confluence.bearish_count) + "/6 ğŸ”´"

    table.cell(conf_table, 0, 2, "Confluencia",
         text_color=color.white,
         bgcolor=color.new(color.gray, 50))
    table.cell(conf_table, 1, 2, conf_text,
         text_color=color.white,
         bgcolor=color.new(color.gray, 80))
    table.merge_cells(conf_table, 1, 2, 2, 2)

    // Score
    table.cell(conf_table, 0, 3, "Score",
         text_color=color.white,
         bgcolor=color.new(color.gray, 50),
         text_size=size.small)
    table.cell(conf_table, 1, 3, "ğŸŸ¢ " + str.tostring(confluence.bull_score, "#") + "%",
         text_color=color.white,
         bgcolor=color.new(color.green, 70),
         text_size=size.small)
    table.cell(conf_table, 2, 3, "ğŸ”´ " + str.tostring(confluence.bear_score, "#") + "%",
         text_color=color.white,
         bgcolor=color.new(color.red, 70),
         text_size=size.small)

    // Estado de cada indicador
    table.cell(conf_table, 0, 4, "ğŸ“Š Indicador",
         text_color=color.white,
         bgcolor=color.new(color.gray, 60),
         text_size=size.small)
    table.cell(conf_table, 1, 4, "SeÃ±al",
         text_color=color.white,
         bgcolor=color.new(color.gray, 60),
         text_size=size.small)
    table.cell(conf_table, 2, 4, "Estado",
         text_color=color.white,
         bgcolor=color.new(color.gray, 60),
         text_size=size.small)

    // ASL21
    asl_vote = asl_sig.bullish ? "ğŸŸ¢" : asl_sig.bearish ? "ğŸ”´" : "âšª"
    table.cell(conf_table, 0, 5, "ASL21",
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.tiny)
    table.cell(conf_table, 1, 5, asl_vote,
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.small)
    table.cell(conf_table, 2, 5, asl_sig.status,
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.tiny)

    // EMA
    ema_vote = ema_sig.bullish ? "ğŸŸ¢" : ema_sig.bearish ? "ğŸ”´" : "âšª"
    table.cell(conf_table, 0, 6, "EMAs",
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.tiny)
    table.cell(conf_table, 1, 6, ema_vote,
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.small)
    table.cell(conf_table, 2, 6, ema_sig.status,
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.tiny)

    // MACD
    macd_vote = macd_sig.bullish ? "ğŸŸ¢" : macd_sig.bearish ? "ğŸ”´" : "âšª"
    table.cell(conf_table, 0, 7, "MACD",
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.tiny)
    table.cell(conf_table, 1, 7, macd_vote,
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.small)
    table.cell(conf_table, 2, 7, macd_sig.status,
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.tiny)

    // RSI
    rsi_vote = rsi_sig.bullish ? "ğŸŸ¢" : rsi_sig.bearish ? "ğŸ”´" : "âšª"
    table.cell(conf_table, 0, 8, "RSI",
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.tiny)
    table.cell(conf_table, 1, 8, rsi_vote,
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.small)
    table.cell(conf_table, 2, 8, rsi_sig.status,
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.tiny)

    // Volumen + Momentum combinados
    vol_mom_bull = vol_sig.bullish or mom_sig.bullish
    vol_mom_bear = vol_sig.bearish or mom_sig.bearish
    vol_mom_vote = vol_mom_bull ? "ğŸŸ¢" : vol_mom_bear ? "ğŸ”´" : "âšª"
    vol_mom_status = vol_sig.status + " / " + mom_sig.status

    table.cell(conf_table, 0, 9, "Vol/Mom",
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.tiny)
    table.cell(conf_table, 1, 9, vol_mom_vote,
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.small)
    table.cell(conf_table, 2, 9, vol_mom_status,
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.tiny)

    // NUEVO: Fila de filtros de calidad
    if show_filters
        filter_color = confluence.strong_buy or confluence.strong_sell ? color.new(color.green, 60) : buy_filters.all_pass or sell_filters.all_pass ? color.new(color.orange, 60) : color.new(color.red, 60)

        active_filter = confluence.strong_buy or confluence.strong_sell ? (confluence.strong_buy ? buy_filters.reason : sell_filters.reason) : buy_filters.reason

        table.cell(conf_table, 0, 10, "Filtros",
             text_color=color.white,
             bgcolor=color.new(color.gray, 80),
             text_size=size.tiny)
        table.cell(conf_table, 1, 10, active_filter,
             text_color=color.white,
             bgcolor=filter_color,
             text_size=size.tiny)
        table.merge_cells(conf_table, 1, 10, 2, 10)

// Segunda tabla: RecomendaciÃ³n
if show_table and barstate.islast
    var table rec_table = table.new(position.bottom_right, 2, 2,
         border_width=2,
         border_color=color.gray,
         frame_width=2,
         frame_color=color.gray)

    // Header
    table.cell(rec_table, 0, 0, "RECOMENDACIÃ“N",
         text_color=color.white,
         bgcolor=color.new(color.blue, 20),
         text_size=size.small)
    table.merge_cells(rec_table, 0, 0, 1, 0)

    // RecomendaciÃ³n
    rec_color = confluence.strong_buy ? color.new(color.lime, 30) : confluence.strong_sell ? color.new(color.maroon, 30) : color.new(color.gray, 60)

    rec_text = confluence.recommendation
    if confluence.strong_buy or confluence.strong_sell
        rec_text := rec_text + "\n$" + str.tostring(close, "#.##")

    table.cell(rec_table, 0, 1, rec_text,
         text_color=color.white,
         bgcolor=rec_color,
         text_size=size.normal)
    table.merge_cells(rec_table, 0, 1, 1, 1)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ALERTAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alertcondition(enable_alerts and new_buy_signal,
     "CONFLUENCIA v7: COMPRA FUERTE",
     "ğŸš€ COMPRAR en ${{close}} - Confluencia: {{plot_0}}/6 - Score: {{plot_1}}%")

alertcondition(enable_alerts and new_sell_signal,
     "CONFLUENCIA v7: VENTA FUERTE",
     "âš ï¸ VENDER en ${{close}} - Confluencia: {{plot_0}}/6 - Score: {{plot_1}}%")

// Plots para alertas
plot(confluence.bullish_count, "Bull Count", display=display.none)
plot(confluence.bull_score, "Bull Score", display=display.none)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GUÃA DE USO v7 - ULTRA PRECISIÃ“N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// MEJORAS EN VERSIÃ“N 7:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// ğŸ¯ FILTROS DE CALIDAD (NUEVO):
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 1. FILTRO DE TENDENCIA: No compra en bajista fuerte, no vende en alcista fuerte
// 2. FILTRO DE VELA: Evita velas indecisas con sombras largas
// 3. FILTRO DE VOLUMEN: Requiere volumen mÃ­nimo para confirmar
// 4. FILTRO DE COOLDOWN: Evita seÃ±ales repetidas (5 barras mÃ­nimo por defecto)
//
// ğŸ“Š MEJORAS EN SCORE:
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// - Score mÃ­nimo aumentado de 60% a 70% (mÃ¡s exigente)
// - PonderaciÃ³n mejorada: EMAs y MACD tienen mÃ¡s peso (25% cada uno)
// - ASL, RSI: 15% cada uno
// - Volumen, Momentum: 10% cada uno
//
// âš™ï¸ CONFIGURACIÃ“N RECOMENDADA:
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// - Confluencia mÃ­nima: 4/6 (mÃ¡s estricto que 3/6)
// - Score mÃ­nimo: 70%
// - Todos los filtros activados
// - Barras entre seÃ±ales: 5
//
// ğŸ¯ VENTAJAS:
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// âœ“ Menos seÃ±ales falsas (mayor precisiÃ³n)
// âœ“ Mejor timing de entrada
// âœ“ Evita operar contra tendencia fuerte
// âœ“ Filtra seÃ±ales en consolidaciÃ³n/indecisiÃ³n
// âœ“ Requiere confirmaciÃ³n de volumen
//
// ğŸ“ˆ CÃ“MO INTERPRETAR:
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// - "âœ“ COMPRA" / "âœ“ VENTA" = SeÃ±al validada (todos los filtros OK)
// - "Compra Filtrada" = Buena confluencia pero filtros rechazaron
// - Tabla muestra quÃ© filtro bloqueÃ³ la seÃ±al (si aplica)
//
// ğŸ’¡ IMPORTANTE:
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Si ves muchas seÃ±ales "filtradas", revisa los filtros:
// - Puede que estÃ©s en mercado lateral (filtro de tendencia actÃºa)
// - Puede que el volumen sea bajo
// - Puede haber muchas velas indecisas
//
// Ajusta los filtros segÃºn tu estilo de trading:
// - Scalping/Day Trading: Relaja filtros, usa 3/6 confluencia
// - Swing Trading: MantÃ©n filtros estrictos, usa 4-5/6 confluencia
//

