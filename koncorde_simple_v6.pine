//@version=6
//Â© Diego Santacruz
indicator(title="Koncorde Simple v6", shorttitle="KoncordeSp", overlay=false)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIGURACIÃ“N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ParÃ¡metros bÃ¡sicos
show_signals = input.bool(true, "Mostrar SeÃ±ales de Trading", group="VisualizaciÃ³n")
show_table = input.bool(true, "Mostrar Tabla Explicativa", group="VisualizaciÃ³n")
show_zones = input.bool(true, "Mostrar Zonas Extremas", group="VisualizaciÃ³n")

// Alertas
enable_alerts = input.bool(true, "Activar Alertas", group="Alertas")

// Colores
color_verde = input.color(#00E676, "Verde (Volumen Alcista)", group="Colores")
color_marron = input.color(#FF9800, "MarrÃ³n (Oscilador Principal)", group="Colores")
color_media = input.color(#F44336, "Media (SeÃ±al)", group="Colores")
color_azul = input.color(#2196F3, "Azul (Volumen Bajista)", group="Colores")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃLCULOS PRINCIPALES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. OSCILADOR PRINCIPAL (MarrÃ³n)
// Combina momentum y volumen de forma simple
// Usa MFI (Money Flow Index) que ya incluye precio + volumen
mfi = ta.mfi(hlc3, 14)                  // Money Flow Index
rsi = ta.rsi(close, 14)                 // RSI
stoch = ta.stoch(close, high, low, 14)  // Stochastic

// Marron = Promedio de los osciladores (normalizado 0-100)
marron = (mfi + rsi + stoch) / 3

// 2. MEDIA (LÃ­nea Roja)
// EMA del oscilador principal - actÃºa como seÃ±al de cruce
media = ta.ema(marron, 15)

// 3. VERDE (Volumen Alcista)
// Detecta cuando hay compras fuertes
// Calculamos si el volumen estÃ¡ creciendo con precio alcista
volume_ma = ta.sma(volume, 20)
volume_ratio = volume / volume_ma  // Ratio de volumen vs promedio

// Verde = Marron + bonus por volumen alcista
volume_boost = close > close[1] and volume > volume_ma ? (volume_ratio - 1) * 20 : 0
verde = marron + volume_boost

// 4. AZUL (Volumen Bajista)
// Detecta cuando hay ventas fuertes
// Similar a verde pero para movimientos bajistas
volume_penalty = close < close[1] and volume > volume_ma ? (volume_ratio - 1) * 20 : 0
azul = volume_penalty * -1  // Negativo para mostrarlo abajo de cero

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SEÃ‘ALES DE TRADING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Cruces bÃ¡sicos (como MACD)
bullish_cross = ta.crossover(marron, media)   // Marron cruza por encima de Media
bearish_cross = ta.crossunder(marron, media)  // Marron cruza por debajo de Media

// Zonas extremas (oversold/overbought)
oversold = marron < 20    // Zona de sobreventa
overbought = marron > 80  // Zona de sobrecompra

// SeÃ±ales fuertes (combinan cruce + zona + volumen)
strong_buy = bullish_cross and marron < 50 and verde > marron  // Cruce alcista con volumen
strong_sell = bearish_cross and marron > 50 and verde < marron // Cruce bajista sin volumen

// Divergencia de volumen (Verde muy por encima/debajo de Marron)
bullish_volume = verde > marron + 10  // Volumen alcista fuerte
bearish_volume = verde < marron - 10  // Volumen bajista (ausente)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ZONAS DE REFERENCIA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Niveles de sobrecompra/sobreventa
hline(80, "Sobrecompra", color=color.new(color.red, 50), linestyle=hline.style_dashed)
hline(50, "LÃ­nea Media", color=color.new(color.gray, 70), linestyle=hline.style_dotted)
hline(20, "Sobreventa", color=color.new(color.green, 50), linestyle=hline.style_dashed)
hline(0, "Cero", color=color.gray, linestyle=hline.style_solid)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLOTEO DE LÃNEAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Plotear las 4 lÃ­neas principales
plot(verde, "Verde (Vol Alcista)", color=color_verde, linewidth=2)
plot(marron, "MarrÃ³n (Oscilador)", color=color_marron, linewidth=2)
plot(media, "Media (SeÃ±al)", color=color_media, linewidth=2)
plot(azul, "Azul (Vol Bajista)", color=color_azul, linewidth=1, style=plot.style_area)

// Relleno entre Marron y Media para visualizar mejor la tendencia
fill_color = marron > media ? color.new(color.green, 90) : color.new(color.red, 90)
fill(plot(marron), plot(media), color=fill_color, title="Relleno Tendencia")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SEÃ‘ALES VISUALES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Cruces bÃ¡sicos
plotshape(show_signals and bullish_cross, "Cruce Alcista",
     shape.triangleup, location.bottom, color.new(color.green, 0),
     size=size.small, text="â–²")

plotshape(show_signals and bearish_cross, "Cruce Bajista",
     shape.triangledown, location.top, color.new(color.red, 0),
     size=size.small, text="â–¼")

// SeÃ±ales fuertes (con cÃ­rculos)
plotshape(show_signals and strong_buy, "COMPRA FUERTE",
     shape.circle, location.bottom, color.new(color.lime, 0),
     size=size.tiny)

plotshape(show_signals and strong_sell, "VENTA FUERTE",
     shape.circle, location.top, color.new(color.maroon, 0),
     size=size.tiny)

// Alertas de volumen (labels)
if show_signals and bullish_volume and marron < 50
    label.new(bar_index, verde, "VOL+",
         color=color.new(color.green, 30),
         textcolor=color.white,
         style=label.style_label_down,
         size=size.tiny)

if show_signals and marron > 50 and verde < marron - 15
    label.new(bar_index, marron, "SIN VOL",
         color=color.new(color.red, 30),
         textcolor=color.white,
         style=label.style_label_up,
         size=size.tiny)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FONDO DE ZONAS EXTREMAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bgcolor(show_zones and oversold ? color.new(color.green, 90) : na, title="Zona Sobreventa")
bgcolor(show_zones and overbought ? color.new(color.red, 90) : na, title="Zona Sobrecompra")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABLA EXPLICATIVA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if show_table and barstate.islast
    var table guide_table = table.new(position.top_right, 2, 7,
         border_width=1,
         border_color=color.gray,
         frame_width=1,
         frame_color=color.gray)

    // Header
    table.cell(guide_table, 0, 0, "Koncorde Simple",
         text_color=color.white,
         bgcolor=color.new(color.blue, 20),
         text_size=size.normal)
    table.merge_cells(guide_table, 0, 0, 1, 0)

    // Estado actual
    current_state = marron > media ? "ALCISTA â†‘" : "BAJISTA â†“"
    state_color = marron > media ? color.new(color.green, 70) : color.new(color.red, 70)

    table.cell(guide_table, 0, 1, "Estado",
         text_color=color.white,
         bgcolor=color.new(color.gray, 50),
         text_size=size.small)
    table.cell(guide_table, 1, 1, current_state,
         text_color=color.white,
         bgcolor=state_color,
         text_size=size.small)

    // Zona actual
    zone_text = oversold ? "SOBREVENTA" : (overbought ? "SOBRECOMPRA" : "NEUTRAL")
    zone_color = oversold ? color.new(color.green, 70) : (overbought ? color.new(color.red, 70) : color.new(color.gray, 70))

    table.cell(guide_table, 0, 2, "Zona",
         text_color=color.white,
         bgcolor=color.new(color.gray, 50),
         text_size=size.small)
    table.cell(guide_table, 1, 2, zone_text,
         text_color=color.white,
         bgcolor=zone_color,
         text_size=size.small)

    // Volumen
    vol_text = verde > marron + 5 ? "ALCISTA +" : (verde < marron - 5 ? "BAJISTA -" : "NEUTRAL")
    vol_color = verde > marron + 5 ? color.new(color.green, 70) : (verde < marron - 5 ? color.new(color.red, 70) : color.new(color.gray, 70))

    table.cell(guide_table, 0, 3, "Volumen",
         text_color=color.white,
         bgcolor=color.new(color.gray, 50),
         text_size=size.small)
    table.cell(guide_table, 1, 3, vol_text,
         text_color=color.white,
         bgcolor=vol_color,
         text_size=size.small)

    // Valores
    table.cell(guide_table, 0, 4, "MarrÃ³n",
         text_color=color.white,
         bgcolor=color.new(color.gray, 50),
         text_size=size.tiny)
    table.cell(guide_table, 1, 4, str.tostring(marron, "#.#"),
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.tiny)

    table.cell(guide_table, 0, 5, "Verde",
         text_color=color.white,
         bgcolor=color.new(color.gray, 50),
         text_size=size.tiny)
    table.cell(guide_table, 1, 5, str.tostring(verde, "#.#"),
         text_color=color.white,
         bgcolor=color.new(color.gray, 80),
         text_size=size.tiny)

    table.cell(guide_table, 0, 6, "Diferencia",
         text_color=color.white,
         bgcolor=color.new(color.gray, 50),
         text_size=size.tiny)
    table.cell(guide_table, 1, 6, str.tostring(verde - marron, "#.#"),
         text_color=color.white,
         bgcolor=vol_color,
         text_size=size.tiny)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ALERTAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alertcondition(enable_alerts and bullish_cross,
     "Koncorde Cruce Alcista",
     "ğŸŸ¢ MarrÃ³n cruzÃ³ por encima de Media")

alertcondition(enable_alerts and bearish_cross,
     "Koncorde Cruce Bajista",
     "ğŸ”´ MarrÃ³n cruzÃ³ por debajo de Media")

alertcondition(enable_alerts and strong_buy,
     "Koncorde COMPRA FUERTE",
     "ğŸ’š SeÃ±al de COMPRA con volumen alcista")

alertcondition(enable_alerts and strong_sell,
     "Koncorde VENTA FUERTE",
     "â¤ï¸ SeÃ±al de VENTA sin volumen comprador")

alertcondition(enable_alerts and oversold and bullish_cross,
     "Koncorde Sobreventa + Cruce",
     "ğŸ“ˆ Cruce alcista en zona de SOBREVENTA")

alertcondition(enable_alerts and overbought and bearish_cross,
     "Koncorde Sobrecompra + Cruce",
     "ğŸ“‰ Cruce bajista en zona de SOBRECOMPRA")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GUÃA DE USO SIMPLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// CÃ“MO USAR KONCORDE SIMPLE:
//
// 1. LAS 4 LÃNEAS:
//    ğŸŸ¢ VERDE: Representa el volumen ALCISTA (compras)
//       - Cuando estÃ¡ MUY por encima de MarrÃ³n = Compras fuertes
//       - Cuando estÃ¡ por debajo de MarrÃ³n = Sin volumen comprador
//
//    ğŸŸ  MARRÃ“N: Oscilador principal (promedio de MFI, RSI, Stochastic)
//       - Por encima de Media (50) = Tendencia alcista
//       - Por debajo de Media (50) = Tendencia bajista
//
//    ğŸ”´ MEDIA: SeÃ±al de referencia (EMA del MarrÃ³n)
//       - ActÃºa como la lÃ­nea Signal en el MACD
//       - Los cruces generan seÃ±ales de trading
//
//    ğŸ”µ AZUL: Volumen BAJISTA (ventas)
//       - Aparece como Ã¡rea negativa (debajo de cero)
//       - Mientras mÃ¡s grande, mÃ¡s ventas hay
//
// 2. SEÃ‘ALES DE TRADING:
//    â–² TriÃ¡ngulo Verde = MarrÃ³n cruza por encima de Media (COMPRA)
//    â–¼ TriÃ¡ngulo Rojo = MarrÃ³n cruza por debajo de Media (VENTA)
//    â— CÃ­rculo = SeÃ±al FUERTE con confirmaciÃ³n de volumen
//
// 3. ZONAS:
//    Zona Verde (0-20) = SOBREVENTA â†’ Buscar compras
//    Zona Neutral (20-80) = Rango normal
//    Zona Roja (80-100) = SOBRECOMPRA â†’ Buscar ventas
//
// 4. INTERPRETACIÃ“N DEL VOLUMEN:
//    Label "VOL+" = Hay volumen alcista fuerte (bueno para compras)
//    Label "SIN VOL" = No hay volumen comprador (peligro si alcista)
//
// 5. MEJORES SEÃ‘ALES:
//    âœ… Cruce alcista en sobreventa + Verde > MarrÃ³n = COMPRA IDEAL
//    âœ… Cruce bajista en sobrecompra + Verde < MarrÃ³n = VENTA IDEAL
//    âœ… Verde muy por encima de MarrÃ³n = Compras institucionales
//    âš ï¸ MarrÃ³n subiendo pero Verde bajando = Divergencia, cuidado
//
// 6. EJEMPLO DE TRADING:
//    COMPRA: â–² + Zona verde/neutral + "VOL+" + Verde > MarrÃ³n
//    VENTA: â–¼ + Zona roja/neutral + "SIN VOL" + Verde < MarrÃ³n
//
// 7. DIFERENCIAS CON KONCORDE COMPLETO:
//    - CÃ¡lculos simplificados (MFI+RSI+Stoch vs PVI/NVI complejo)
//    - Sin columnas (solo lÃ­neas para claridad)
//    - Menos parÃ¡metros configurables
//    - SeÃ±ales automÃ¡ticas claras
//    - MÃ¡s fÃ¡cil de entender para principiantes
